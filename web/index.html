<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chicken Feeder Control</title>
    <script>
        // Optional mock API: add ?mock=1 to the URL to enable local fake endpoints
        if (new URLSearchParams(window.location.search).has('mock')) {
            document.write('<script src="./mock/api.js"><\\/script>');
        }
    </script>
</head>
<body>
    <div class="page">
        <header class="topbar">
            <div class="brand">
                <div class="logo">üêî</div>
                <div>
                    <p class="eyebrow">Automatic Feeder</p>
                    <h1>Chicken Station</h1>
                </div>
            </div>
            <div class="status-pill" id="statusIndicator">
                <span class="status-dot online"></span>
                <span>Online</span>
            </div>
        </header>

        <main class="layout">
            <section class="panel hero">
                <div class="hero-text">
                    <p class="eyebrow">Manual control</p>
                    <h2>Feed your flock</h2>
                    <p class="muted">Trigger a feed cycle instantly without waiting for the schedule.</p>
                    <button class="feed-button" id="manualFeedBtn">
                        <span class="feed-icon">üåæ</span>
                        <span>Feed Now</span>
                    </button>
                </div>
                <div class="hero-stats">
                    <div class="stat-card">
                        <p class="label">Servo</p>
                        <p class="value" id="servoPosition">Closed</p>
                    </div>
                    <div class="stat-card">
                        <p class="label">Last feed</p>
                        <p class="value" id="lastFeedTime">Never</p>
                    </div>
                </div>
            </section>

            <section class="panel schedule-panel">
                <div class="panel-header">
                    <div>
                        <p class="eyebrow">Schedules</p>
                        <h3>Weekly routine</h3>
                        <p class="muted">Enable up to four feedings and tune time, days and portion.</p>
                    </div>
                </div>
                <div class="portion-unit-row">
                    <label for="portionUnitInput">Portion size (g per unit)</label>
                    <input id="portionUnitInput" type="number" min="1" max="100" step="1" value="12">
                </div>
                <div class="feed-timers">
                    <div class="timer-row" data-index="0">
                        <div class="timer-main">
                            <label class="toggle-switch-small start-toggle">
                                <input type="checkbox" class="timer-enabled">
                                <span class="toggle-slider-small"></span>
                            </label>
                            <span class="portion-inline">12g</span>
                            <input type="time" class="timer-time" value="06:30">
                            <div class="weekdays-checks">
                                <label class="weekday-check"><input type="checkbox" data-day="1"><span>Mon</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="2"><span>Tue</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="3"><span>Wed</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="4"><span>Thu</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="5"><span>Fri</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="6"><span>Sat</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="0"><span>Sun</span></label>
                            </div>
                            <button class="expand-btn" aria-label="Show portion settings">‚ñº</button>
                        </div>
                        <div class="timer-details">
                            <div class="detail-row">
                                <input type="range" class="portion-slider" min="1" max="5" value="1" step="1">
                            </div>
                        </div>
                    </div>

                    <div class="timer-row" data-index="1">
                        <div class="timer-main">
                            <label class="toggle-switch-small start-toggle">
                                <input type="checkbox" class="timer-enabled">
                                <span class="toggle-slider-small"></span>
                            </label>
                            <span class="portion-inline">12g</span>
                            <input type="time" class="timer-time" value="12:00">
                            <div class="weekdays-checks">
                                <label class="weekday-check"><input type="checkbox" data-day="1"><span>Mon</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="2"><span>Tue</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="3"><span>Wed</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="4"><span>Thu</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="5"><span>Fri</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="6"><span>Sat</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="0"><span>Sun</span></label>
                            </div>
                            <button class="expand-btn" aria-label="Show portion settings">‚ñº</button>
                        </div>
                        <div class="timer-details">
                            <div class="detail-row">
                                <input type="range" class="portion-slider" min="1" max="5" value="1" step="1">
                            </div>
                        </div>
                    </div>

                    <div class="timer-row" data-index="2">
                        <div class="timer-main">
                            <label class="toggle-switch-small start-toggle">
                                <input type="checkbox" class="timer-enabled">
                                <span class="toggle-slider-small"></span>
                            </label>
                            <span class="portion-inline">12g</span>
                            <input type="time" class="timer-time" value="18:00">
                            <div class="weekdays-checks">
                                <label class="weekday-check"><input type="checkbox" data-day="1"><span>Mon</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="2"><span>Tue</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="3"><span>Wed</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="4"><span>Thu</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="5"><span>Fri</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="6"><span>Sat</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="0"><span>Sun</span></label>
                            </div>
                            <button class="expand-btn" aria-label="Show portion settings">‚ñº</button>
                        </div>
                        <div class="timer-details">
                            <div class="detail-row">
                                <input type="range" class="portion-slider" min="1" max="5" value="1" step="1">
                            </div>
                        </div>
                    </div>

                    <div class="timer-row" data-index="3">
                        <div class="timer-main">
                            <label class="toggle-switch-small start-toggle">
                                <input type="checkbox" class="timer-enabled">
                                <span class="toggle-slider-small"></span>
                            </label>
                            <span class="portion-inline">12g</span>
                            <input type="time" class="timer-time" value="22:00">
                            <div class="weekdays-checks">
                                <label class="weekday-check"><input type="checkbox" data-day="1"><span>Mon</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="2"><span>Tue</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="3"><span>Wed</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="4"><span>Thu</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="5"><span>Fri</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="6"><span>Sat</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="0"><span>Sun</span></label>
                            </div>
                            <button class="expand-btn" aria-label="Show portion settings">‚ñº</button>
                        </div>
                        <div class="timer-details">
                            <div class="detail-row">
                                <input type="range" class="portion-slider" min="1" max="5" value="1" step="1">
                            </div>
                        </div>
                    </div>

                    <div class="timer-row" data-index="4">
                        <div class="timer-main">
                            <label class="toggle-switch-small start-toggle">
                                <input type="checkbox" class="timer-enabled">
                                <span class="toggle-slider-small"></span>
                            </label>
                            <span class="portion-inline">12g</span>
                            <input type="time" class="timer-time" value="00:00">
                            <div class="weekdays-checks">
                                <label class="weekday-check"><input type="checkbox" data-day="1"><span>Mon</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="2"><span>Tue</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="3"><span>Wed</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="4"><span>Thu</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="5"><span>Fri</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="6"><span>Sat</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="0"><span>Sun</span></label>
                            </div>
                            <button class="expand-btn" aria-label="Show portion settings">‚ñº</button>
                        </div>
                        <div class="timer-details">
                            <div class="detail-row">
                                <input type="range" class="portion-slider" min="1" max="5" value="1" step="1">
                            </div>
                        </div>
                    </div>

                    <div class="timer-row" data-index="5">
                        <div class="timer-main">
                            <label class="toggle-switch-small start-toggle">
                                <input type="checkbox" class="timer-enabled">
                                <span class="toggle-slider-small"></span>
                            </label>
                            <span class="portion-inline">12g</span>
                            <input type="time" class="timer-time" value="00:00">
                            <div class="weekdays-checks">
                                <label class="weekday-check"><input type="checkbox" data-day="1"><span>Mon</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="2"><span>Tue</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="3"><span>Wed</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="4"><span>Thu</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="5"><span>Fri</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="6"><span>Sat</span></label>
                                <label class="weekday-check"><input type="checkbox" data-day="0"><span>Sun</span></label>
                            </div>
                            <button class="expand-btn" aria-label="Show portion settings">‚ñº</button>
                        </div>
                        <div class="timer-details">
                            <div class="detail-row">
                                <input type="range" class="portion-slider" min="1" max="5" value="1" step="1">
                            </div>
                        </div>
                    </div>
                
                </div>
                
                <button class="ghost-btn save-full" id="saveScheduleBtn">Save changes</button>
            </section>

            <section class="panel guide-panel">
                <div class="panel-header">
                    <div>
                        <p class="eyebrow">Feeding guide</p>
                        <h3>Portions & timing</h3>
                        <p class="muted">Quick reference for freerange hens (2‚Äì2.5 kg).</p>
                    </div>
                </div>
                <div class="guide-grid">
                    <div class="guide-card">
                        <h4>Daily intake</h4>
                        <ul class="guide-list">
                            <li>Target 80‚Äì120 g complete feed/hen (up to ~130 g for high layers).</li>
                            <li>Winter: +10‚Äì20% for warmth.</li>
                            <li>Freerange foraging covers 20‚Äì50% of the diet.</li>
                        </ul>
                    </div>
                    <div class="guide-card">
                        <h4>Feed choice</h4>
                        <ul class="guide-list">
                            <li>Layer/land hen feed: ~16% protein, 3.5‚Äì4% calcium.</li>
                            <li>Grain base ~60%, plant protein ~20%; add grit + oyster shell free choice.</li>
                            <li>Keep fruit/veg treats under 10% to avoid dilution.</li>
                        </ul>
                    </div>
                    <div class="guide-card">
                        <h4>Timing (auto)</h4>
                        <ul class="guide-list">
                            <li>2‚Äì3 drops/day: 60‚Äì70% at sunrise, small top-ups midday & pre-dusk.</li>
                            <li>Sync timers to local sunrise/sunset; add +20% in winter.</li>
                            <li>Short block feedings; avoid always-full troughs.</li>
                        </ul>
                    </div>
                    <div class="guide-card">
                        <h4>Portion ideas</h4>
                        <ul class="guide-list">
                            <li>Start: 40‚Äì60 g morning, 20‚Äì30 g noon/evening.</li>
                            <li>Let users tune by flock size/weight; watch intake vs. 120 g target.</li>
                            <li>Consider alerts for low intake (&lt;80 g) or stale feed (humidity/weight).</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section class="panel backup-panel">
                <div class="panel-header">
                    <div>
                        <p class="eyebrow">Maintenance</p>
                        <h3>Backup & Updates</h3>
                        <p class="muted">Configuration backup and firmware updates.</p>
                    </div>
                </div>

                <div class="maintenance-section">
                    <h4 class="section-subtitle">Configuration</h4>
                    <p class="muted small-text">Save or restore your timer configuration as JSON.</p>
                    <div class="backup-actions">
                        <button class="ghost-btn" id="exportConfigBtn">Export JSON</button>
                        <label class="ghost-btn upload-label">
                            Import JSON
                            <input type="file" id="importConfigInput" accept="application/json">
                        </label>
                    </div>
                </div>

                <div class="maintenance-section">
                    <h4 class="section-subtitle">Firmware Update (OTA)</h4>
                    <p class="muted small-text">Upload new firmware directly over WiFi. Device will reboot automatically after update.</p>
                    <div class="ota-status" id="otaStatus">
                        <span class="status-dot online"></span>
                        <span id="otaStatusText">Ready for firmware update</span>
                    </div>
                    <div class="backup-actions">
                        <label class="ghost-btn upload-label" id="otaUploadLabel">
                            Select Firmware (.bin)
                            <input type="file" id="otaFirmwareInput" accept=".bin">
                        </label>
                        <button class="ghost-btn" id="otaUploadBtn" disabled>Upload Firmware</button>
                    </div>
                    <div class="ota-progress-container" id="otaProgressContainer" style="display: none;">
                        <div class="ota-progress-bar">
                            <div class="ota-progress-fill" id="otaProgressFill"></div>
                        </div>
                        <p class="ota-progress-text" id="otaProgressText">0%</p>
                    </div>
                </div>
            </section>
        </main>

        <footer class="footer">
            <div class="footer-left">
                <p>Chicken Feeder WebUI</p>
                <p class="muted">Freerange-friendly scheduling & portions.</p>
                <p class="footer-version" id="uiVersion"></p>
            </div>
            <div class="footer-right">
                <button class="sleep-btn" id="deepSleepBtn">Shut down &amp; sleep</button>
                <a class="footer-link" href="https://github.com/Friedjof/AutomaticChickenFeeder" target="_blank" rel="noopener">View on GitHub</a>
            </div>
        </footer>
    </div>

    <div class="toast" id="toast">
        <span id="toastMessage"></span>
    </div>

    <script type="module" src="./src/main.js"></script>
</body>
</html>
